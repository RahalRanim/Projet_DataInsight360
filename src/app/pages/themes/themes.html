<div class="themes-container">
    <!-- Header -->
    <div class="themes-header">
        <h1 class="page-title">Gestion des Thèmes</h1>
        <p class="page-subtitle">Créez et gérez vos catégories de datasets</p>
    </div>

    <!-- Section de contrôles -->
    <div class="controls-section-modern">
        <!-- Barre de recherche -->
        <div class="search-box-modern">
            <i class="ri-search-line"></i>
            <input 
                type="text" 
                placeholder="Rechercher un thème..." 
                class="search-input-modern"
                [(ngModel)]="searchTerm"
                (input)="applyFilters()">
        </div>

        <!-- Séparateur visuel -->
        <div class="separator"></div>

        <!-- Actions et résultats -->
        <div class="actions-compact" *ngIf="hasActiveFilters">
            <span class="results-count-modern">{{ filteredThemes.length }} résultat(s)</span>
            <button class="clear-filters-modern" (click)="clearFilters()">
                <i class="ri-close-circle-fill"></i>
                Effacer
            </button>
        </div>

        <!-- Bouton Nouveau Thème à droite -->
        <div class="new-theme-section">
            <button class="new-theme-btn" (click)="createNewTheme()">
                <i class="ri-add-circle-fill"></i>
                Nouveau thème
            </button>
        </div>
    </div>

    <!-- Grille des thèmes -->
    <div class="themes-grid">
        <!-- Thème Card -->
        <div 
            class="theme-card" 
            *ngFor="let theme of filteredThemes; trackBy: trackByThemeId">
            
            <div class="theme-header">
                <h3 class="theme-name">{{ theme.libelle }}</h3>
                <span class="theme-badge">
                    {{ theme.datasetsCount || 0 }} dataset(s)
                </span>
            </div>
            
            <div class="theme-actions">
                <button class="action-btn edit-btn" (click)="editTheme(theme)">
                    <i class="ri-edit-line"></i>
                    Modifier
                </button>
                <button class="action-btn delete-btn" (click)="confirmDelete(theme)">
                    <i class="ri-delete-bin-line"></i>
                    Supprimer
                </button>
            </div>
        </div>

        <!-- État vide -->
        <div class="empty-state" *ngIf="filteredThemes.length === 0">
            <i class="ri-price-tag-3-line"></i>
            <h3>Aucun thème trouvé</h3>
            <p *ngIf="!searchTerm">Commencez par créer votre premier thème.</p>
            <p *ngIf="searchTerm">Aucun thème ne correspond à votre recherche.</p>
            <button *ngIf="!searchTerm" class="clear-filters-btn primary" (click)="createNewTheme()">
                Créer un thème
            </button>
            <button *ngIf="searchTerm" class="clear-filters-btn primary" (click)="clearFilters()">
                Effacer la recherche
            </button>
        </div>
    </div>
</div>

<!-- Modale d'ajout/modification de thème SIMPLIFIÉE -->
<div class="modal-overlay-theme" *ngIf="showThemeModal" (click)="closeThemeModal()">
    <div class="modal-container-theme" (click)="$event.stopPropagation()">
        <div class="modal-header-theme">
            <h2 class="modal-title-theme">
                {{ editingTheme ? 'Modifier le thème' : 'Nouveau Thème' }}
            </h2>
            <button class="modal-close-theme" (click)="closeThemeModal()">
                <i class="ri-close-line"></i>
            </button>
        </div>

        <form class="modal-form-theme" [formGroup]="themeForm" (ngSubmit)="onThemeSubmit()">
            <!-- Champ Libellé -->
            <div class="form-group-theme">
                <label for="themeLibelle" class="form-label-theme">
                    Nom du thème 
                </label>
                <input
                    type="text"
                    id="themeLibelle"
                    formControlName="libelle"
                    class="form-input-theme"
                    placeholder="Ex: Finance, Santé, Transport..."
                    [class.error]="themeForm.get('libelle')?.invalid && themeForm.get('libelle')?.touched">
                <div class="error-message-theme" *ngIf="themeForm.get('libelle')?.invalid && themeForm.get('libelle')?.touched">
                    <span *ngIf="themeForm.get('libelle')?.errors?.['required']">Le nom du thème est requis</span>
                    <span *ngIf="themeForm.get('libelle')?.errors?.['minlength']">Le nom doit contenir au moins 2 caractères</span>
                </div>
            </div>

            <!-- Zone d'affichage des erreurs générales -->
            <div class="form-group-theme" *ngIf="formError">
                <div class="error-summary-theme">
                    {{ formError }}
                </div>
            </div>

            <!-- Actions du formulaire -->
            <div class="form-actions-theme">
                <button type="button" class="btn-cancel-theme" (click)="closeThemeModal()">
                    Annuler
                </button>
                <button type="submit" class="btn-submit-theme" [disabled]="isSubmitting">
                    <i class="ri-add-line" *ngIf="!isSubmitting && !editingTheme"></i>
                    <i class="ri-edit-line" *ngIf="!isSubmitting && editingTheme"></i>
                    <i class="ri-loader-4-line spinning" *ngIf="isSubmitting"></i>
                    {{ isSubmitting ? 'Traitement...' : (editingTheme ? 'Modifier' : 'Ajouter') }}
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modales existantes -->
<app-confirm-modal 
  *ngIf="showConfirmModal"
  title="Confirmer la suppression"
  [message]="getDeleteMessage()"
  btnOkText="Supprimer"
  btnCancelText="Annuler"
  (close)="onConfirmModalClose($event)">
</app-confirm-modal>

<app-succes-modal 
  *ngIf="showSuccessModal"
  title="Succès"
  [message]="successMessage"
  btnText="OK"
  (close)="onSuccessModalClose()">
</app-succes-modal>

<app-error-modal 
  *ngIf="showErrorModal"
  title="Erreur"
  [message]="errorMsg"
  btnText="OK"
  (close)="onErrorModalClose()">
</app-error-modal>